@model IEnumerable<ApexDrive.Models.Car>
@{
    ViewData["Title"] = "Car Management";
    Layout = "~/Areas/Admin/Views/Shared/_Layout.cshtml";
}

<h1 class="text-2xl font-bold text-brand mb-6">🚘 Car Management</h1>

<!-- ✅ Search and Filter Section -->
<form method="get" class="mb-6 flex flex-col md:flex-row md:items-center md:justify-between gap-4 bg-white p-4 rounded-xl shadow-sm">
    <div class="flex items-center space-x-2 flex-1">
        <input type="text" name="search" value="@Context.Request.Query["search"]"
               class="w-full md:w-80 border border-gray-300 rounded-lg px-3 py-2 text-sm focus:ring-brand focus:border-brand"
               placeholder="🔍 Search by Plate, Brand, or Model..." />
        <button type="submit"
                class="px-4 py-2 bg-brand text-white rounded-lg text-sm font-medium hover:bg-blue-700 transition">
            Search
        </button>
    </div>

    @if (User.IsInRole("SuperAdmin"))
    {
        <div class="flex items-center space-x-2">
            <label class="text-sm font-medium text-gray-600">Branch:</label>
            <select name="branchId"
                    class="border border-gray-300 rounded-lg px-3 py-2 text-sm focus:ring-brand focus:border-brand">
                <option value="">All</option>
                @foreach (var branch in ViewBag.Branches as List<ApexDrive.Models.Branch>)
                {
                    <option value="@branch.BranchId" selected="@(Context.Request.Query["branchId"] == branch.BranchId.ToString())">
                        @branch.BranchName
                    </option>
                }
            </select>
            <button type="submit"
                    class="px-3 py-2 bg-gray-100 text-gray-700 rounded-lg text-sm font-medium hover:bg-gray-200 transition">
                Filter
            </button>
        </div>
    }
</form>

<!-- ✅ Add Button -->
<div class="flex justify-end mb-4">
    <a asp-action="Create" class="px-4 py-2 bg-brand text-white rounded-lg hover:bg-blue-700 font-medium">➕ Add Car</a>
</div>

<!-- ✅ Car Table -->
<table class="min-w-full bg-white rounded-lg shadow-sm">
    <thead class="bg-gray-100 text-gray-700 text-sm uppercase">
        <tr>
            <th class="py-3 px-4 text-left">Plate</th>
            <th class="py-3 px-4 text-left">Brand</th>
            <th class="py-3 px-4 text-left">Model</th>
            <th class="py-3 px-4 text-left">Daily Rate</th>
            <th class="py-3 px-4 text-left">Branch</th>
            <th class="py-3 px-4 text-left">Status</th>
            <th class="py-3 px-4 text-right">Actions</th>
        </tr>
    </thead>
    <tbody>
        @if (!Model.Any())
        {
            <tr>
                <td colspan="7" class="text-center py-6 text-gray-400">No cars found.</td>
            </tr>
        }
        else
        {
            @foreach (var car in Model)
            {
                <tr class="border-b hover:bg-gray-50">
                    <td class="py-3 px-4 font-medium">@car.PlateNumber</td>
                    <td class="py-3 px-4">@car.Brand</td>
                    <td class="py-3 px-4">@car.Model</td>
                    <td class="py-3 px-4">@car.DailyRate.ToString("C")</td>
                    <td class="py-3 px-4">@car.Branch?.BranchName</td>
                    <td class="py-3 px-4 flex items-center gap-2">
                        @if (car.IsAvailable)
                        {
                            <span class="px-2 py-1 rounded-lg bg-green-100 text-green-700 text-xs font-semibold">Available</span>
                        }
                        else
                        {
                            <span class="px-2 py-1 rounded-lg bg-red-100 text-red-700 text-xs font-semibold">Unavailable</span>
                        }

                        <form asp-action="ToggleAvailability" method="post" class="inline">
                            <input type="hidden" name="id" value="@car.CarId" />
                            <button type="submit"
                                    class="px-2 py-1 text-xs rounded-lg border border-gray-200 hover:bg-gray-100 transition">
                                @if (car.IsAvailable)
                                {
                                    <span>❌ Disable</span>
                                }
                                else
                                {
                                    <span>✅ Enable</span>
                                }
                            </button>
                        </form>
                    </td>

                    <td class="py-3 px-4 text-right space-x-2">
                        <a asp-action="Edit" asp-route-id="@car.CarId"
                           class="px-3 py-1 rounded bg-gray-100 hover:bg-gray-200 text-gray-700 text-sm">✏️ Edit</a>
                        <a asp-action="Delete" asp-route-id="@car.CarId"
                           class="px-3 py-1 rounded bg-red-100 hover:bg-red-200 text-red-700 text-sm">🗑️ Delete</a>
                    </td>
                </tr>
            }
        }
    </tbody>
</table>
