@model ApexDrive.Models.Car
@{
    ViewData["Title"] = "Edit Car";
    Layout = "~/Areas/Admin/Views/Shared/_Layout.cshtml";
}

<section class="max-w-4xl mx-auto mt-12">
    <!-- ✅ Title -->
    <div class="flex items-center justify-between mb-6">
        <h1 class="text-3xl font-bold text-gray-800">
            <span class="text-blue-600">✏️</span> Edit Car
        </h1>
        <a asp-action="Index"
           class="inline-flex items-center gap-2 text-sm font-medium text-gray-600 hover:text-blue-600 transition">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24"
                 stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                      d="M15 19l-7-7 7-7" />
            </svg>
            Back to List
        </a>
    </div>

    <!-- ✅ Alert messages -->
    @if (TempData["Success"] != null)
    {
        <div id="alert-success"
             class="mb-6 flex items-center justify-between rounded-xl bg-green-50 border border-green-200 p-4 text-green-700 shadow-sm transition">
            <span>@TempData["Success"]</span>
            <button onclick="this.parentElement.remove()" class="text-green-500 hover:text-green-700">✕</button>
        </div>
    }
    @if (TempData["Error"] != null)
    {
        <div id="alert-error"
             class="mb-6 flex items-center justify-between rounded-xl bg-red-50 border border-red-200 p-4 text-red-700 shadow-sm transition">
            <span>@TempData["Error"]</span>
            <button onclick="this.parentElement.remove()" class="text-red-500 hover:text-red-700">✕</button>
        </div>
    }

    <!-- ✅ Form -->
    <form asp-area="Admin" asp-controller="Cars" asp-action="Edit" method="post"
          enctype="multipart/form-data"
          class="bg-white rounded-2xl shadow-md p-8 border border-gray-100 space-y-8">
        @Html.AntiForgeryToken()

        <input type="hidden" asp-for="CarId" />
        <input type="hidden" asp-for="ImageUrl" />

        <div asp-validation-summary="ModelOnly"
             class="text-red-500 text-sm bg-red-50 border border-red-200 rounded-lg p-3"></div>

        <!-- 🚘 Basic Info -->
        <div class="grid md:grid-cols-2 gap-6">
            <div>
                <label asp-for="PlateNumber" class="block text-sm font-semibold text-gray-700">Plate Number</label>
                <input asp-for="PlateNumber"
                       class="mt-1 w-full border-gray-300 rounded-xl shadow-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500" />
                <span asp-validation-for="PlateNumber" class="text-red-500 text-sm"></span>
            </div>
            <div>
                <label asp-for="Brand" class="block text-sm font-semibold text-gray-700">Brand</label>
                <input asp-for="Brand"
                       class="mt-1 w-full border-gray-300 rounded-xl shadow-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500" />
                <span asp-validation-for="Brand" class="text-red-500 text-sm"></span>
            </div>
        </div>

        <div class="grid md:grid-cols-2 gap-6">
            <div>
                <label asp-for="Model" class="block text-sm font-semibold text-gray-700">Model</label>
                <input asp-for="Model"
                       class="mt-1 w-full border-gray-300 rounded-xl shadow-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500" />
                <span asp-validation-for="Model" class="text-red-500 text-sm"></span>
            </div>
            <div>
                <label asp-for="DailyRate" class="block text-sm font-semibold text-gray-700">Daily Rate (฿)</label>
                <input asp-for="DailyRate" type="number" step="0.01"
                       class="mt-1 w-full border-gray-300 rounded-xl shadow-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500" />
                <span asp-validation-for="DailyRate" class="text-red-500 text-sm"></span>
            </div>
        </div>

        <!-- ⚙️ Technical Info -->
        <div class="grid md:grid-cols-3 gap-6">
            <div>
                <label asp-for="Type" class="block text-sm font-semibold text-gray-700">Type</label>
                <input asp-for="Type"
                       class="mt-1 w-full border-gray-300 rounded-xl shadow-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                       placeholder="SUV, Sedan..." />
            </div>
            <div>
                <label asp-for="Transmission" class="block text-sm font-semibold text-gray-700">Transmission</label>
                <input asp-for="Transmission"
                       class="mt-1 w-full border-gray-300 rounded-xl shadow-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                       placeholder="Automatic / Manual" />
            </div>
            <div>
                <label asp-for="FuelType" class="block text-sm font-semibold text-gray-700">Fuel Type</label>
                <input asp-for="FuelType"
                       class="mt-1 w-full border-gray-300 rounded-xl shadow-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                       placeholder="Petrol / Diesel / Hybrid" />
            </div>
        </div>

        <!-- 🔧 Mileage & Branch -->
        <div class="grid md:grid-cols-2 gap-6">
            <div>
                <label asp-for="Mileage" class="block text-sm font-semibold text-gray-700">Mileage (km)</label>
                <input asp-for="Mileage" class="mt-1 w-full border-gray-300 rounded-xl shadow-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500" />
                <span asp-validation-for="Mileage" class="text-red-500 text-sm"></span>
            </div>
            <div>
                <label asp-for="BranchId" class="block text-sm font-semibold text-gray-700">Branch</label>
                @if (User.IsInRole("SuperAdmin"))
                {
                    <select asp-for="BranchId"
                            asp-items="@(new SelectList(ViewBag.Branches, "BranchId", "BranchName", Model.BranchId))"
                            class="mt-1 w-full border-gray-300 rounded-xl shadow-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                        <option value="">-- Select Branch --</option>
                    </select>
                }
                else
                {
                    <input type="hidden" asp-for="BranchId" />
                }
                <span asp-validation-for="BranchId" class="text-red-500 text-sm"></span>
            </div>
        </div>

        <!-- 🖼️ Image Section -->
        <div class="border-t border-gray-200 pt-6">
            <h3 class="font-semibold text-gray-700 mb-2">Car Image</h3>

            @if (!string.IsNullOrEmpty(Model.ImageUrl))
            {
                <div class="flex items-center gap-6">
                    <img src="@Model.ImageUrl" alt="Car Image"
                         class="w-44 h-28 object-cover rounded-xl border shadow-sm hover:scale-[1.02] transition-transform" />
                    <div>
                        <p class="text-sm text-gray-500 mb-2">You can upload a new image to replace the existing one.</p>
                        <input type="file" name="newImageFile" accept="image/*"
                               class="w-full text-sm border border-gray-300 rounded-xl px-3 py-2 focus:ring-2 focus:ring-blue-500 focus:border-blue-500" />
                    </div>
                </div>
            }
            else
            {
                <div class="mt-2">
                    <p class="text-sm text-red-500 mb-2">⚠️ No image currently uploaded.</p>
                    <input type="file" name="newImageFile" accept="image/*"
                           class="w-full text-sm border border-gray-300 rounded-xl px-3 py-2 focus:ring-2 focus:ring-blue-500 focus:border-blue-500" />
                </div>
            }
        </div>

        <!-- ✅ Buttons -->
        <div class="flex justify-end gap-3 pt-6 border-t border-gray-200">
            <a asp-action="Index"
               class="px-5 py-2.5 rounded-xl bg-gray-100 hover:bg-gray-200 text-gray-700 font-medium transition">Cancel</a>
            <button type="submit"
                    class="px-5 py-2.5 rounded-xl bg-blue-600 hover:bg-blue-700 text-white font-medium shadow-md transition">
                💾 Save Changes
            </button>
        </div>
    </form>
</section>

@section Scripts {
    <partial name="_ValidationScriptsPartial" />
    <script>
        // ✅ Fade alerts automatically
        setTimeout(() => {
            document.querySelectorAll('#alert-success, #alert-error').forEach(el => {
                el.classList.add('opacity-0', 'transition-opacity', 'duration-700');
                setTimeout(() => el.remove(), 700);
            });
        }, 3000);
    </script>
}
